Rootkit Programming - Exercise 6

You should have recieved the following files (in the archive ex1.tar):
 * README
 * generateSysmap.sh
 * Makefile
 * hide_sockets.c

We implement socket hiding by hooking tcp_show and udp_show in procfs. This solves the task 
for netstat. For ss, it solves UDP. In order to hide TCP sockets from ss, we also
hook the function socketcall and return -1 by default. This makes ss call the function
tcp_show as well and process its return values.

To start the module, invoke it in one of the following ways (arguments should be
self-explanatory):

insmod hide_sockets.ko prot_to_hide=tcp port_to_hide=25
insmod hide_sockets.ko prot_to_hide=udp port_to_hide=12345

Rootkit Programming - Exercise 3

We hook getdents64 (resp. getdents) to hide files beginning with the prefix "rootkit_".
We simply call the original getdents-functions, and iterate over the resulting
dirents. As soon as we find an entry with d_name beginning with "rootkit_",
we "erase" it by moving the remaining part forward in memory (see code for
intuitive description).
Note that getdents64 is the function that is called in most of the cases.
We tested getdents-hook using a test program (testprogram.c).
We could also have done it by manipulating the previous item such that it 
appears to be longer and thus kind of shades the item beginning with "rootkit_".
This is, we modify d_reclen accordingly.
We've actually implemented it, but we like the other solution more.

Rootkit Programming - Exercise 2

We hook sys_read by changing the function pointer in the system call table
to a function hooked_read accepting the same parameters as the original
read function. hooked_read prints out all parameters and the result of the 
original read call.

We considered using try_module_get and put_module to avoid "unallowed unloading"
of our module. However, we ran into some troubles using these, while without 
them, everything seemed just fine. So, we abandoned it. However, you can add it
if you #define USE_MODULE_GET_PUT. That is, you can - before compilation - 
decide, whether you want to use it or not.

Rootkit Programming - Exercise 1

Note that generateSysmap.sh relies on grep and sed to transform system.map 
into a C header file.

Furthermore, for some reason Virtualbox sometimes can't compile the thing from within a shared folder.
